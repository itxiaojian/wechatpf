!function(r){function q(a,f){this.itemsArray=[],this.$element=r(a),this.$element.hide(),this.isSelect="SELECT"===a.tagName,this.multiple=this.isSelect&&a.hasAttribute("multiple"),this.objectItems=f&&f.itemValue,this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=r('<div class="bootstrap-tagsinput"></div>'),this.$input=r('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container);var e=(this.inputSize<3?3:this.inputSize)+"em";this.$input.get(0).style.cssText="width: "+e+" !important;",this.build(f)}function p(e,d){if("function"!=typeof e[d]){var f=e[d];e[d]=function(b){return b[f]}}}function o(e,d){if("function"!=typeof e[d]){var f=e[d];e[d]=function(){return f}}}function n(b){return b?j.text(b).html():""}function m(e){var d=0;if(document.selection){e.focus();var f=document.selection.createRange();f.moveStart("character",-e.value.length),d=f.text.length}else{(e.selectionStart||"0"==e.selectionStart)&&(d=e.selectionStart)}return d}function l(a,f){var e=!1;return r.each(f,function(b,s){if("number"==typeof s&&a.which===s){return e=!0,!1}if(a.which===s.which){var i=!s.hasOwnProperty("altKey")||a.altKey===s.altKey,h=!s.hasOwnProperty("shiftKey")||a.shiftKey===s.shiftKey,d=!s.hasOwnProperty("ctrlKey")||a.ctrlKey===s.ctrlKey;if(i&&h&&d){return e=!0,!1}}}),e}var k={tagClass:function(){return"label label-info"},itemValue:function(b){return b?b.toString():b},itemText:function(b){return this.itemValue(b)},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],onTagExists:function(d,c){c.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};q.prototype={constructor:q,add:function(C,B){var A=this;if(!(A.options.maxTags&&A.itemsArray.length>=A.options.maxTags||C!==!1&&!C)){if("string"==typeof C&&A.options.trimValue&&(C=r.trim(C)),"object"==typeof C&&!A.objectItems){throw"Can't add objects when itemValue option is not set"}if(!C.toString().match(/^\s*$/)){if(A.isSelect&&!A.multiple&&A.itemsArray.length>0&&A.remove(A.itemsArray[0]),"string"==typeof C&&"INPUT"===this.$element[0].tagName){var z=C.split(",");if(z.length>1){for(var y=0;y<z.length;y++){this.add(z[y],!0)}return void (B||A.pushVal())}}var x=A.options.itemValue(C),w=A.options.itemText(C),v=A.options.tagClass(C),u=r.grep(A.itemsArray,function(b){return A.options.itemValue(b)===x})[0];if(!u||A.options.allowDuplicates){if(!(A.items().toString().length+C.length+1>A.options.maxInputLength)){var t=r.Event("beforeItemAdd",{item:C,cancel:!1});if(A.$element.trigger(t),!t.cancel){A.itemsArray.push(C);var s=r('<span class="tag '+n(v)+'">'+n(w)+'<span data-role="remove"></span></span>');if(s.data("item",C),A.findInputWrapper().before(s),s.after(" "),A.isSelect&&!r('option[value="'+encodeURIComponent(x)+'"]',A.$element)[0]){var e=r("<option selected>"+n(w)+"</option>");e.data("item",C),e.attr("value",x),A.$element.append(e)}B||A.pushVal(),(A.options.maxTags===A.itemsArray.length||A.items().toString().length===A.options.maxInputLength)&&A.$container.addClass("bootstrap-tagsinput-max"),A.$element.trigger(r.Event("itemAdded",{item:C}))}}}else{if(A.options.onTagExists){var a=r(".tag",A.$container).filter(function(){return r(this).data("item")===u});A.options.onTagExists(C,a)}}}}},remove:function(a,h){var g=this;if(g.objectItems&&(a="object"==typeof a?r.grep(g.itemsArray,function(b){return g.options.itemValue(b)==g.options.itemValue(a)}):r.grep(g.itemsArray,function(b){return g.options.itemValue(b)==a}),a=a[a.length-1]),a){var f=r.Event("beforeItemRemove",{item:a,cancel:!1});if(g.$element.trigger(f),f.cancel){return}r(".tag",g.$container).filter(function(){return r(this).data("item")===a}).remove(),r("option",g.$element).filter(function(){return r(this).data("item")===a}).remove(),-1!==r.inArray(a,g.itemsArray)&&g.itemsArray.splice(r.inArray(a,g.itemsArray),1)}h||g.pushVal(),g.options.maxTags>g.itemsArray.length&&g.$container.removeClass("bootstrap-tagsinput-max"),g.$element.trigger(r.Event("itemRemoved",{item:a}))},removeAll:function(){var a=this;for(r(".tag",a.$container).remove(),r("option",a.$element).remove();a.itemsArray.length>0;){a.itemsArray.pop()}a.pushVal()},refresh:function(){var a=this;r(".tag",a.$container).each(function(){var v=r(this),u=v.data("item"),t=a.options.itemValue(u),s=a.options.itemText(u),e=a.options.tagClass(u);if(v.attr("class",null),v.addClass("tag "+n(e)),v.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=n(s),a.isSelect){var b=r("option",a.$element).filter(function(){return r(this).data("item")===u});b.attr("value",t)}})},items:function(){return this.itemsArray},pushVal:function(){var a=this,d=r.map(a.items(),function(b){return a.options.itemValue(b).toString()});a.$element.val(d,!0).trigger("change")},build:function(a){var f=this;if(f.options=r.extend({},k,a),f.objectItems&&(f.options.freeInput=!1),p(f.options,"itemValue"),p(f.options,"itemText"),o(f.options,"tagClass"),f.options.typeahead){var d=f.options.typeahead||{};o(d,"source"),f.$input.typeahead(r.extend({},d,{source:function(e,t){function s(v){for(var u=[],x=0;x<v.length;x++){var w=f.options.itemText(v[x]);i[w]=v[x],u.push(w)}t(u)}this.map={};var i=this.map,h=d.source(e);r.isFunction(h.success)?h.success(s):r.isFunction(h.then)?h.then(s):r.when(h).then(s)},updater:function(b){f.add(this.map[b])},matcher:function(b){return -1!==b.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(b){return b.sort()},highlighter:function(g){var e=new RegExp("("+this.query+")","gi");return g.replace(e,"<strong>$1</strong>")}}))}if(f.options.typeaheadjs){var c=f.options.typeaheadjs||{};f.$input.typeahead(null,c).on("typeahead:selected",r.proxy(function(g,e){f.add(c.valueKey?e[c.valueKey]:e),f.$input.typeahead("val","")},f))}f.$container.on("click",r.proxy(function(){f.$element.attr("disabled")||f.$input.removeAttr("disabled"),f.$input.focus()},f)),f.options.addOnBlur&&f.options.freeInput&&f.$input.on("focusout",r.proxy(function(){0===r(".typeahead, .twitter-typeahead",f.$container).length&&(f.add(f.$input.val()),f.$input.val(""))},f)),f.$container.on("keydown","input",r.proxy(function(e){var y=r(e.target),x=f.findInputWrapper();if(f.$element.attr("disabled")){return void f.$input.attr("disabled","disabled")}switch(e.which){case 8:if(0===m(y[0])){var w=x.prev();w&&f.remove(w.data("item"))}break;case 46:if(0===m(y[0])){var v=x.next();v&&f.remove(v.data("item"))}break;case 37:var u=x.prev();0===y.val().length&&u[0]&&(u.before(x),y.focus());break;case 39:var t=x.next();0===y.val().length&&t[0]&&(t.after(x),y.focus())}var s=y.val().length;Math.ceil(s/5);y.attr("size",Math.max(this.inputSize,y.val().length))},f)),f.$container.on("keypress","input",r.proxy(function(e){var t=r(e.target);if(f.$element.attr("disabled")){return void f.$input.attr("disabled","disabled")}var s=t.val(),i=f.options.maxChars&&s.length>=f.options.maxChars;f.options.freeInput&&(l(e,f.options.confirmKeys)||i)&&(f.add(i?s.substr(0,f.options.maxChars):s),t.val(""),e.preventDefault());var g=t.val().length;Math.ceil(g/5);t.attr("size",Math.max(this.inputSize,t.val().length))},f)),f.$container.on("click","[data-role=remove]",r.proxy(function(e){f.$element.attr("disabled")||f.remove(r(e.target).closest(".tag").data("item"))},f)),f.options.itemValue===k.itemValue&&("INPUT"===f.$element[0].tagName?f.add(f.$element.val()):r("option",f.$element).each(function(){f.add(r(this).attr("value"),!0)}))},destroy:function(){var b=this;b.$container.off("keypress","input"),b.$container.off("click","[role=remove]"),b.$container.remove(),b.$element.removeData("tagsinput"),b.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var a=this.$input[0],d=this.$container[0];a&&a.parentNode!==d;){a=a.parentNode}return r(a)}},r.fn.tagsinput=function(f,b){var a=[];return this.each(function(){var d=r(this).data("tagsinput");if(d){if(f||b){if(void 0!==d[f]){var c=d[f](b);void 0!==c&&a.push(c)}}else{a.push(d)}}else{d=new q(this,f),r(this).data("tagsinput",d),a.push(d),"SELECT"===this.tagName&&r("option",r(this)).attr("selected","selected"),r(this).val(r(this).val())}}),"string"==typeof f?a.length>1?a:a[0]:a},r.fn.tagsinput.Constructor=q;var j=r("<div />");r(function(){r("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);